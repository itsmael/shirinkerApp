
use master
select name from sys.database_files where type_desc='LOG'

select l.name, d.name from sys.master_files l 
inner join sys.databases d on d.database_id = l.database_id where l.type = 1s 



select * from sys.databases


DECLARE @NOME AS VARCHAR(255) ;
DECLARE @QUERY AS VARCHAR(255);
DECLARE @BKP_PATH AS VARCHAR(255);
SET @BKP_PATH = '''C:\caminho-para-bkp\' ;
 
DECLARE CURSOR_NOME CURSOR FOR
	SELECT
		NAME
	FROM 
		SYS.DATABASES
	WHERE
		NAME NOT IN ('master', 'tempdb', 'model', 'msdb') AND NAME LIKE ('%CARGAS')  OR NAME LIKE ('%FROTA') or name like ('%cargas_%') or name like ('%FROTA%')

OPEN CURSOR_NOME 
PRINT @NOME

FETCH NEXT FROM CURSOR_NOME INTO @NOME;
    WHILE @@FETCH_STATUS = 0  
    BEGIN 
		
		PRINT 'SETANDO ' + @NOME + ' OFFLINE';
	    SET @QUERY = 'ALTER DATABASE [' + @NOME + ']SET OFFLINE WITH ROLLBACK IMMEDIATE';
		EXEC(@QUERY);

		PRINT 'SETANDO ' + @NOME + ' ONLINE' ;
		SET @QUERY = 'ALTER DATABASE [' + @NOME + ']SET ONLINE ';
		EXEC(@QUERY);
		
		PRINT 'RENOMEANDO ' + @NOME ;	
		SET @QUERY = 'ALTER DATABASE [' + @NOME + '] MODIFY NAME='+@NOME+'_';
		EXEC(@QUERY);

		PRINT 'REALIZANDO O BACKUP DE ' + @NOME + '_';
		SET @QUERY = 'BACKUP DATABASE ' + @NOME + '_' + ' TO DISK = ' + @BKP_PATH + @NOME + '.BAK''';
		PRINT @QUERY
		EXEC (@QUERY)
		
        FETCH NEXT FROM CURSOR_NOME INTO @NOME     
    END  
  
CLOSE CURSOR_NOME   
DEALLOCATE CURSOR_NOME 